<ac:layout>
    <ac:layout-section ac:type="two_equal">
        <ac:layout-cell>
            <h1>Task Description</h1>

            <ac:structured-macro ac:name="section">
                <ac:rich-text-body>
                    {% if image is not none %}
                    <ac:structured-macro ac:name="column">
                        <ac:parameter ac:name="width">30%</ac:parameter>
                        <ac:rich-text-body>
                            <ac:image>
                                <ri:attachment ri:filename="{{ image["name"] }}"/>
                            </ac:image>
                        </ac:rich-text-body>
                    </ac:structured-macro>
                    <ac:structured-macro ac:name="column">
                        <ac:parameter ac:name="width">70%</ac:parameter>
                        <ac:rich-text-body>
                            <p>{{ description }}</p>
                            <h4>Workflow path</h4>{{ workflow_file }}
                            <h4>Configuration path</h4>{{ config_file }}
                        </ac:rich-text-body>
                    </ac:structured-macro>
                    {% else %}
                    <p>{{ description }}</p>
                    <h4>Workflow path</h4>{{ workflow_file }}
                    <h4>Configuration path</h4>{{ config_file }}
                    {% endif %}
                </ac:rich-text-body>
            </ac:structured-macro>
            {% if errors_pt is defined %}
            <h1>Results</h1>
            <table>
                <tbody>
                    <tr>
                        <th>set</th>
                        <th>accuracy</th>
                        <th>errors</th>
                    </tr>
                    {% for i in range(3) %}
                    {% if class_lengths[i] > 0 %}
                    <tr>
                        <td>{{ ("test", "validation", "train")[i] }}</td>
                        <td>{{ (100 - errors_pt[i])|round(4) }}%</td>
                        <td>{{ errors_pt[i]|round(4) }}%</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            <h1>Source data</h1>
            <h4>Samples</h4><p>Total number: {{ total_samples }}</p>
            <table>
                <tbody>
                    <tr>
                        <th>set</th>
                        <th>number of samples</th>
                    </tr>
                    <tr>
                        <td>test</td>
                        <td>{{ class_lengths[0] }}</td>
                    </tr>
                    <tr>
                        <td>validation</td>
                        <td>{{ class_lengths[1] }}</td>
                    </tr>
                    <tr>
                        <td>train</td>
                        <td>{{ class_lengths[2] }}</td>
                    </tr>
                </tbody>
            </table>
            <h4>Labels</h4><p>Total number: {{ labels|length }}</p>
            <p>{{ labels|sort }}</p>
            <table>
                <tbody>
                    <tr>
                        <th>set</th>
                        <th>label stats</th>
                    </tr>
                    <tr>
                        <td>test</td>
                        <td>{{ label_stats[0]|dictsort }}</td>
                    </tr>
                    <tr>
                        <td>validation</td>
                        <td>{{ label_stats[1]|dictsort }}</td>
                    </tr>
                    <tr>
                        <td>train</td>
                        <td>{{ label_stats[2]|dictsort }}</td>
                    </tr>
                </tbody>
            </table>
            <h4>Normalization</h4>
            <table>
                <tbody>
                    <tr>
                        <td>type of normalization</td>
                        <td>{{ normalization }}</td>
                    </tr>
                    <tr>
                        <td>normalization parameters</td>
                        <td>{{ normalization_parameters }}</td>
                    </tr>
                </tbody>
            </table>
            <h1>Run stats</h1>
            <table>
                <tbody>
                    <tr>
                        <td>time</td>
                        <td>{{ days }} days, {{ hours }} hours, {{ mins }}
                            minutes, {{ secs|round(1) }} secs
                        </td>
                    </tr>
                    <tr>
                        <td>number of epochs</td>
                        <td>{{ epochs }}</td>
                    </tr>
                </tbody>
            </table>
            <table>
                <tbody>
                    <tr>
                        <th>unit class</th>
                        <th>run time</th>
                    </tr>
                    {% for unit, value in unit_run_times_by_class|dictsort(by='value') %}
                    <tr>
                        <td>{{ unit }}</td>
                        <td>{{ value|round(4) }} secs
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <h1>Configuration</h1>
            <ac:structured-macro ac:name="noformat">
                <ac:plain-text-body>
                    <![CDATA[{{ config_text }}]]></ac:plain-text-body>
            </ac:structured-macro>
        </ac:layout-cell>
        <ac:layout-cell>
            <h1>Workflow</h1>
            <p>
                <ac:image ac:width="600">
                    <ri:attachment ri:filename="workflow.png"/>
                </ac:image>
            </p>
            <h1>Plots</h1>
            <p>
                {% for name in plots|sort %}
                <h4>{{ name }}</h4>
                <ac:image ac:width="600">
                    <ri:attachment ri:filename="{{ name }}.png"/>
                </ac:image>
                <br/>
                {% endfor %}
            </p>
        </ac:layout-cell>
    </ac:layout-section>
</ac:layout>
