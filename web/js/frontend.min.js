function disable(e){$(".argument:not(."+e+")").addClass("disabled"),$(".panel-heading:not(."+e+")").addClass("disabled"),$(".form-control:not(."+e+")").attr("disabled","disabled"),$(".switch:not(."+e+")").bootstrapSwitch("disabled",!0),$(".dropdown-toggle:not(."+e+")").attr("disabled","disabled")}function enable_all(){$(".argument").removeClass("disabled"),$(".panel-heading").removeClass("disabled"),$(".form-control").removeAttr("disabled","disabled"),$(".switch").bootstrapSwitch("disabled",!1),$(".dropdown-toggle").removeAttr("disabled","disabled")}function initial_disable(){common_mode=$("#dropdownMode").text().trim(),common_mode=common_mode.toLowerCase(),disable(common_mode)}function activate_mode(e){$("#dropdownMode").get(0).firstChild.nodeValue=e+" ",e=e.toLowerCase(),enable_all(),disable(e)}function select_mode(e){activate_mode(e);var a=$("#command-line").val().replace(/\s+/," "),t=parse_cl(a);cmdline_states=from_args_to_states(t,cmdline_states),$.each(states,function(t,s){var i=$("#"+t);i.hasClass(e)||(delete cmdline_states[t],a=a.replace(t+" "+s,""),a=a.replace(t,""))}),elem.val(a)}function select(e,a){$("#dropdown_menu"+a).get(0).firstChild.nodeValue=e+" ",e=e.toLowerCase();var a=a,t=e,s=set_arg_state(a,t);if(s!=t){var i=$("#command-line"),n=i.val(),o=/\s+/;n=n.replace(o," "),n=-1!=n.indexOf(a+" "+s)?n.replace(a+" "+s,a+" "+t):a+" "+t+" "+n,i.val(n)}}function get_diff(e,a){var t={},s=Object.keys(e).concat(Object.keys(a));for(var i in s){var n=s[i],o=e[n],r=a[n];t[n]=void 0==o&&void 0!=r?"created":void 0!=o&&void 0==r?"deleted":void 0!=o&&void 0!=r&&o==r?"unchanged":"updated"}return t}function parse_cl(e){if(e.match(/(^|\s+)-\w\w+/))return null;var a=minimist_parse(e.split(/\s+/),opts),t=a._,s=[];if(t.length<=positional_opts.length)for(var i in t)a[positional_opts[i]]=t[i];else for(var i in t)void 0!=positional_opts[i]&&i!=positional_opts.length-1?a[positional_opts[i]]=t[i]:(s.push(t[i]),a[positional_opts[positional_opts.length-1]]=s);return delete a._,a}function from_args_to_states(e,a){return $.each(e,function(e,t){-1!=$.inArray(e,positional_opts)?a[e]=t:void 0==opts.alias[e]&&(a["--"+e]=t)}),a}function build_switch_regexp(e){return new RegExp("(\\s|^)"+e+"(\\s|$)")}function build_arg_regexp(e){return new RegExp("(\\s|^)"+e+"([ =]|$)[^\\s-]*")}function set_arg_state(e,a){var t=cmdline_states[e];return cmdline_states[e]=a,t}function change_cl_by_input(e,a,t,s){function i(){var e=[].slice.call(arguments,2);return e.join(" ")}function n(){return[].filter.call(arguments,function(e){return e}).join(" ")}var o=cmdline_states.workflow,r=cmdline_states.config,l=cmdline_states.config_list;if(-1==$.inArray(s,positional_opts)){var d="-"+alias_reversed[s.substring(2)];switch(d){case"m":activate_mode("Slave");break;case"l":activate_mode("Master");break;default:activate_mode("Standalone")}e.match(build_arg_regexp(s))||d&&e.match(build_arg_regexp(d))?(e=e.replace(build_arg_regexp(s),s+" "+t),d&&(e=e.replace(build_arg_regexp(d),d+" "+t))):e=s+" "+t+" "+e}else{var c=n(o,r,l),_=i(s,t,o,r,l);-1!=e.indexOf(a)?e=e.replace(a,t):-1!=e.indexOf(c)?e=e.replace(c,_):e+=" "+t}return e}function set_error_test(e){$("#error-message").text(e)}function run(){$.ajax({url:"cmdline",type:"POST",data:JSON.stringify({cmdline:$("#command-line").val()}),contentType:"application/json; charset=utf-8",async:!0,success:function(){window.close()}})}var alias_reversed={};for(var key in opts.alias)alias_reversed[opts.alias[key]]=key;initial_disable();var substringMatcher=function(e){return function(a,t){var s,i;s=[],i=new RegExp(a,"i"),$.each(e,function(e,a){i.test(a)&&s.push({value:a})}),t(s)}};$(".typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"workflows",displayKey:"value",source:substringMatcher(workflows)}),$(function(){$("input:not(#command-line)").on("change",function(){var e=this.id,a=this.value,t=set_arg_state(e,a);if(t!=a){var s=$("#command-line"),i=s.val(),n=/\s+/;i=i.replace(n," "),i=change_cl_by_input(i,t,a,e),s.val(i)}}),$(".switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(e,a){var t=this.id,s=a,i=set_arg_state(t,s);if(i!=s){var n=$("#command-line"),o=n.val(),r="-"+alias_reversed[t.substring(2)];s?r&&o.match(build_switch_regexp(r))||(o=t+" "+o):(o=o.replace(build_switch_regexp(t),""),r&&(o=o.replace(build_switch_regexp(r),""))),n.val(o)}}),$(".typeahead").on("typeahead:selected",function(e,a){var t=a,s=cmdline_states.workflow,i=t.value,n=cmdline_states.config,o=cmdline_states.config_list;void 0==n&&(n="",space=""),void 0==o&&(o="",space=""),cmdline_states.workflow=i;var r=$("#command-line"),l=r.val(),d=/\s+/;if(l=l.replace(d," "),-1!=l.indexOf(s))l=l.replace(s,i);else{var c=n+space+o;-1!=l.indexOf(n+space+o)?l=l.replace(n+space+o,i+" "+c):l+=i}r.val(l)}),$("#command-line").on("input",function(){var e=$("#command-line").val(),a=parse_cl(e);if(null!==a){var t={};$.each(cmdline_states,function(e,s){t[e]=s,opt_for_arg=e.replace(/^-+/,""),void 0==a[opt_for_arg]&&(cmdline_states[e]=defaults[e])}),cmdline_states=from_args_to_states(a,cmdline_states);var s=get_diff(t,cmdline_states);invalid=!1,mode="Standalone";for(var i in s){var n=s[i],o=cmdline_states[i],r=$("#"+i);if("unchanged"!=n&&"deleted"!=n&&("created"==n||"updated"==n)){switch(i){case"--master-address":mode="Slave";break;case"--listen-address":mode="Master"}if(r.hasClass("switch")&&r.bootstrapSwitch("state",o),(r.hasClass("typeahead")||r.hasClass("form-control")&&!r.hasClass("typeahead"))&&r.val(o),r.hasClass("dropdown-menu")){var l=$("#dropdown_menu"+i);-1!=$.inArray(o,choices[i])?l.get(0).firstChild.nodeValue=o:(set_error_test("Wrong value of "+i+". You should choose from "+choices[i]),invalid=!0)}r.hasClass("switch")||r.hasClass("form-control")||r.hasClass("dropdown-menu")||-1!=$.inArray(i,special_opts)||(set_error_test("Wrong option "+i),invalid=!0,delete cmdline_states[i]);for(var d in opts.alias)e.match(build_switch_regexp("-"+d))&&e.match(build_switch_regexp("--"+opts.alias[d]))&&(set_error_test("Duplicate option: --"+opts.alias[d]),invalid=!0)}}activate_mode(mode),$("#error-message").css("opacity",invalid?"1":"0")}})}),$(function(){$("#command-line").trigger("input")});