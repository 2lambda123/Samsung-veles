var RenderControls=function(e){var i=jQuery;this.initialize=function(){this.element=e.element,this.graph=e.graph,this.settings=this.serialize(),this.inputs={renderer:this.element.elements.renderer,interpolation:this.element.elements.interpolation,offset:this.element.elements.offset},this.element.addEventListener("change",function(e){this.settings=this.serialize(),"renderer"==e.target.name&&this.setDefaultOffset(e.target.value),this.syncOptions(),this.settings=this.serialize();var i={renderer:this.settings.renderer,interpolation:this.settings.interpolation};"value"==this.settings.offset?(i.unstack=!0,i.offset="zero"):"expand"==this.settings.offset?(i.unstack=!1,i.offset=this.settings.offset):(i.unstack=!1,i.offset=this.settings.offset),this.graph.configure(i),this.graph.render()}.bind(this),!1)},this.serialize=function(){var e={},t=i(this.element).serializeArray();return t.forEach(function(i){e[i.name]=i.value}),e},this.syncOptions=function(){var e=this.rendererOptions[this.settings.renderer];Array.prototype.forEach.call(this.inputs.interpolation,function(i){e.interpolation?(i.disabled=!1,i.parentNode.classList.remove("disabled")):(i.disabled=!0,i.parentNode.classList.add("disabled"))}),Array.prototype.forEach.call(this.inputs.offset,function(i){e.offset.filter(function(e){return e==i.value}).length?(i.disabled=!1,i.parentNode.classList.remove("disabled")):(i.disabled=!0,i.parentNode.classList.add("disabled"))}.bind(this))},this.setDefaultOffset=function(e){var i=this.rendererOptions[e];i.defaults&&i.defaults.offset&&Array.prototype.forEach.call(this.inputs.offset,function(e){e.checked=e.value==i.defaults.offset?!0:!1}.bind(this))},this.rendererOptions={area:{interpolation:!0,offset:["zero","wiggle","expand","value"],defaults:{offset:"zero"}},line:{interpolation:!0,offset:["expand","value"],defaults:{offset:"value"}},bar:{interpolation:!1,offset:["zero","wiggle","expand","value"],defaults:{offset:"zero"}},scatterplot:{interpolation:!1,offset:["value"],defaults:{offset:"value"}}},this.initialize()};Rickshaw.Graph.RangeSlider=function(e){var i=this.element=e.element,t=this.graph=e.graph;t.constructor===Array?($(function(){$(i).slider({range:!0,min:t[0].dataDomain()[0],max:t[0].dataDomain()[1],values:[t[0].dataDomain()[0],t[0].dataDomain()[1]],slide:function(e,i){for(var s=0;s<t.length;s++)t[s].window.xMin=i.values[0],t[s].window.xMax=i.values[1],t[s].update(),t[s].dataDomain()[0]==i.values[0]&&(t[s].window.xMin=void 0),t[s].dataDomain()[1]==i.values[1]&&(t[s].window.xMax=void 0)}})}),t[0].onUpdate(function(){var e=$(i).slider("option","values");$(i).slider("option","min",t[0].dataDomain()[0]),$(i).slider("option","max",t[0].dataDomain()[1]),void 0==t[0].window.xMin&&(e[0]=t[0].dataDomain()[0]),void 0==t[0].window.xMax&&(e[1]=t[0].dataDomain()[1]),$(i).slider("option","values",e)})):($(function(){$(i).slider({range:!0,min:t.dataDomain()[0],max:t.dataDomain()[1],values:[t.dataDomain()[0],t.dataDomain()[1]],slide:function(e,i){t.window.xMin=i.values[0],t.window.xMax=i.values[1],t.update(),t.dataDomain()[0]==i.values[0]&&(t.window.xMin=void 0),t.dataDomain()[1]==i.values[1]&&(t.window.xMax=void 0)}})}),t.onUpdate(function(){var e=$(i).slider("option","values");$(i).slider("option","min",t.dataDomain()[0]),$(i).slider("option","max",t.dataDomain()[1]),void 0==t.window.xMin&&(e[0]=t.dataDomain()[0]),void 0==t.window.xMax&&(e[1]=t.dataDomain()[1]),$(i).slider("option","values",e)}))},Rickshaw.Graph.Legend.prototype.initialize=function(e){this.graph=e.graph,this.naturalOrder=e.naturalOrder,this.element=e.element;var i=$(this.element).addClass(this.className).find("#rickshaw-legend");if(this.list=i.get(0),void 0===this.list||e.force===!0){this.list=document.createElement("ul"),this.list.id="rickshaw-legend",this.element.appendChild(this.list),this.render(),$(this.element).addClass(this.className).find("#rickshaw-legend").data("Rickshaw.Graph.Legend",this);for(var t in this.lines){var s=this.lines[t];s.series=[s.series]}this.graph_indices={},this.graph_indices[this.graph.element.id]=0,this.graphs=[this.graph]}else{var n=i.data("Rickshaw.Graph.Legend");this.lines=n.lines,this.graph_indices=n.graph_indices,this.graphs=n.graphs;var a=this.graph.series.map(function(e){return e});this.naturalOrder||(a=a.reverse());for(var t in this.lines){var s=this.lines[t];s.series.push(a[t])}this.graph_indices[this.graph.element.id]=Object.keys(this.graph_indices).length,this.graphs.push(this.graph)}this.graph.onUpdate(function(){})},Rickshaw.Graph.Behavior.Series.Toggle=function(e){this.legend=e.legend,this.graph=this.legend.graph;var i=this,t=i.legend.graph_indices[this.graph.element.id];if(this.addAnchor=function(e){var n=s(e.element).find("#rickshaw-legend-toggle").get(0);void 0===n&&(n=document.createElement("a"),n.innerHTML="&#10004;",n.classList.add("action"),n.id="rickshaw-legend-toggle",e.element.insertBefore(n,e.element.firstChild)),n.addEventListener("click",function(){if(e.series[t].disabled)e.series[t].enable(),e.element.classList.remove("disabled");else{if(this.graph.series.filter(function(e){return!e.disabled}).length<=1)return;e.series[t].disable(),e.element.classList.add("disabled")}i.graph.update()}.bind(this));var a=e.element.getElementsByTagName("span")[0];a.onclick=function(){var t=e.series[0].disabled;if(!t)for(var s=0;s<i.legend.lines.length;s++){var n=i.legend.lines[s];if(e.series===n.series);else if(!n.series[0].disabled){t=!0;break}}if(t){for(var a in e.series)e.series[a].enable();e.element.classList.remove("disabled"),i.legend.lines.forEach(function(i){if(e.series===i.series);else{for(var t in i.series)i.series[t].disable();i.element.classList.add("disabled")}})}else i.legend.lines.forEach(function(e){for(var i in e.series)e.series[i].enable();e.element.classList.remove("disabled")});for(a in i.legend.graphs)graphs[a].update()}},this.legend){var s=jQuery;"undefined"!=typeof s&&s(this.legend.list).sortable&&s(this.legend.list).sortable({start:function(e,i){i.item.bind("no.onclick",function(e){e.preventDefault()})},stop:function(e,i){setTimeout(function(){i.item.unbind("no.onclick")},250)}}),this.legend.lines.forEach(function(e){i.addAnchor(e)})}this._addBehavior=function(){this.graph.series.forEach(function(e){e.disable=function(){if(i.graph.series.length<=1)throw"only one series left";e.disabled=!0},e.enable=function(){e.disabled=!1}})},this._addBehavior(),this.updateBehaviour=function(){this._addBehavior()}},Rickshaw.Graph.Behavior.Series.Highlight=function(e){this.legend=e.legend,this.graph=this.legend.graph;var i=this,t={},s=null,n=i.legend.graph_indices[this.graph.element.id],a=e.disabledColor||function(e){return d3.interpolateRgb(e,d3.rgb("#d8d8d8"))(.8).toString()};this.addHighlightEvents=function(e){e.element.addEventListener("mouseover",function(){s||(s=e,i.legend.lines.forEach(function(s){if(e!==s)t[s.series[n].name]=t[s.series[n].name]||s.series[n].color,s.series[n].color=a(s.series[n].color);else if(i.graph.renderer.unstack&&(s.series[n].renderer?s.series[n].renderer.unstack:!0)){var r=i.graph.series.indexOf(s.series[n]);s.originalIndex=r;var d=i.graph.series.splice(r,1)[0];i.graph.series.push(d)}}),i.graph.update())},!1),e.element.addEventListener("mouseout",function(){s&&(s=null,i.legend.lines.forEach(function(s){if(e===s&&s.hasOwnProperty("originalIndex")){var a=i.graph.series.pop();i.graph.series.splice(s.originalIndex,0,a),delete s.originalIndex}t[s.series[n].name]&&(s.series[n].color=t[s.series[n].name])}),i.graph.update())},!1)},this.legend&&this.legend.lines.forEach(function(e){i.addHighlightEvents(e)})},Rickshaw.Graph.Behavior.Series.Order=function(e){this.legend=e.legend;var i=this;if("undefined"==typeof window.jQuery)throw"couldn't find jQuery at window.jQuery";if("undefined"==typeof window.jQuery.ui)throw"couldn't find jQuery UI at window.jQuery.ui";$(function(){$(i.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(){for(var e in i.legend.graphs){var t=[];$(i.legend.list).find("li").each(function(e,i){i.series&&t.push(i.series)});for(var s=i.legend.graphs[e],n=s.series.length-1;n>=0;n--)s.series[n]=t.shift();s.update()}}}),$(i.legend.list).disableSelection()}),this.legend.graph.onUpdate(function(){var e=window.getComputedStyle(i.legend.element).height;i.legend.element.style.height=e})};