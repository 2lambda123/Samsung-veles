<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="img/veles.png" />
    <title>VELES Command Line Frontend</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-switch.min.css" rel="stylesheet">
    <link href="css/frontend.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    </head>
    <body>
        <div id="command-line-container" class="input-group">
            <span class="input-group-addon">RESULT</span>
            <input type="text" class="form-control standalone master slave" id="command-line">
        </div>
        <div id="arguments">
            <div class="panel panel-primary argument master slave standalone">
                <div class="panel-heading master slave standalone">
                  <span class="label label-danger argtype">Mandatory</span>
                  <h3 class="panel-title">Mode</h3>
                </div>
                <div class="panel-body">
                    <div class="pull-right description">
                      <p>Selects VELES operation mode. Standalone is the best choice for debugging workflows and relatively small tasks. Master mode runs VELES workflow server which accepts slaves. Slave mode is the headless VELES instance which requests jobs from a master and returns results.</p>
                    </div>
                    <div class="dropdown">
                      <button class="btn btn-default dropdown-toggle master slave standalone" type="button" id="dropdownMode" data-toggle="dropdown">
                        Standalone
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMode">
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="select_mode('Standalone')">Standalone</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="select_mode('Master')">Master</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="select_mode('Slave')">Slave</a></li>
                      </ul>
                    </div>
                </div>
            </div>
            {% raw arguments %}
        </div>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="js/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootstrap-switch.min.js"></script>
        <script src="js/typeahead.min.js"></script>
	
        <script>
          initial_disable();

          var substringMatcher = function(strs) {
            return function findMatches(q, cb) {
              var matches, substrRegex;
              matches = [];
              substrRegex = new RegExp(q, 'i');
              $.each(strs, function(i, str) {
                if (substrRegex.test(str)) {
                  matches.push({ value: str });
                }
              });
              cb(matches);
            };
          };

          var workflows = {% raw workflows %};

          var initial_states = {% raw initial_states %};

          $('.typeahead').typeahead({
            hint: true,
            highlight: true,
            minLength: 1
          },
          {
            name: 'workflows',
            displayKey: 'value',
            source: substringMatcher(workflows)
          });

          function disable(mode) {
              $(".argument:not(." + mode + ")").addClass("disabled");
              $(".panel-heading:not(." + mode + ")").addClass("disabled");
              $(".form-control:not(." + mode + ")").attr("disabled", "disabled");
              $(".switch:not(." + mode + ")").bootstrapSwitch('disabled', true);
              $(".dropdown-toggle:not(." + mode + ")").attr("disabled", "disabled");
          };
          function enable_all() {
              $(".argument").removeClass("disabled");
              $(".panel-heading").removeClass("disabled");
              $(".form-control").removeAttr("disabled", "disabled");
              $(".switch").bootstrapSwitch('disabled', false);
              $(".dropdown-toggle").removeAttr("disabled", "disabled");
          };

          function initial_disable() {
              common_mode = $("#dropdownMode").text().trim();
              common_mode = common_mode.toLowerCase();
              disable(common_mode);
          }

	  function select_mode(mode) {
              $("#dropdownMode").get(0).firstChild.nodeValue = mode + " ";
              mode = mode.toLowerCase();
              enable_all();
              disable(mode);
          }

          function select(choice, id) {
              $("#dropdown_menu").get(0).firstChild.nodeValue = choice + " ";
              choice = choice.toLowerCase();
              var id = id;
              var value = choice;
              initial_states[id]=value;
              generate_cl(initial_states);
          }

          function generate_cl(initial_states) {
              var command_line = "";
              var wf = "";
              var config = "";
              var config_list = "";
              var params = "";
              $.each(initial_states, function(key, value) {
              if((key != "config") && (key != "workflow") && (key != "config_list")) {
                  if (value==true) {
                      params+= key + ' ';
                  };
                  if ((value!=true) && (value!=false)) {
                      params+= key + ' ' + value + ' ';
                  };
              };
              if (key == "workflow"){
                  wf = value + " ";};
              if (key == "config"){
                  config = value + " ";};
              if (key == "config_list"){
                  config_list = value + " ";};
              command_line = wf + config + config_list + params;
              });
              
              var elem = document.getElementById("command-line");
              elem.value = command_line;
          }

          $(function() {
              $("input:not(#command-line)").on("change", function() {
              var id = this.id;
              var value = this.value;
              initial_states[id]=value;
              generate_cl(initial_states);
              });
              $(".switch").bootstrapSwitch().on('switchChange.bootstrapSwitch', function(event, state) {
              var id = this.id;
              var value = state;
              initial_states[id]=value;
              generate_cl(initial_states);
              });
              $('.typeahead').on('typeahead:selected', function(event, value) {
              var selected_wf = value;
              var wf = selected_wf["value"];
              initial_states["workflow"]=wf;
              generate_cl(initial_states);
              $(".dropdown-menu li a").click(function(event, value){
                 var value = value;
                 alert(value)
                 });
              });
          });
	</script>
    </body>
</html>
